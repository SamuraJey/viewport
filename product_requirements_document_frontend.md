**Product Requirements Document (Frontend)
Photo Portfolio Site (React + Vite MVP)**

---

## 1. Цели и задачи

* **Основная цель.** Реализовать одностраничное приложение (SPA) для управления галереями и публичного просмотра, интегрированное с готовым FastAPI-бэкендом.
* **Задачи.**

  1. Реализовать интерфейс личного кабинета фотографа: регистрация/логин, список галерей, загрузка фото, генерация ссылок.
  2. Реализовать публичный просмотр по share-ссылке: адаптивная галерея, просмотр фото, скачивание.
  3. Обеспечить надёжную работу с API: отображение состояний загрузки/ошибок, валидность JWT, обновление токенов.
  4. Адаптивный дизайн под десктоп и мобильные устройства.

---

## 2. Технический стек

* **Библиотеки и фреймворки:**

  * React 18+ (функциональные компоненты, hooks)
  * Vite (быстрая сборка, HMR)
  * React Router v6 (маршрутизация)
  * Zustand или Redux Toolkit (управление состоянием, хранение токенов)
  * Axios или Fetch API (HTTP-клиент)
  * Tailwind CSS (утилитарные стили)
  * React Query (опционально для кэширования и управления состоянием запросов)
* **Аутентификация:** хранение access/refresh токенов в HttpOnly cookie или secure storage; автоматический рефреш.

---

## 3. Структура приложения и маршруты

| Маршрут                 | Компонент                | Описание                                                            | Доступ              |
| ----------------------- | ------------------------ | ------------------------------------------------------------------- | ------------------- |
| `/auth/register`        | `RegisterPage`           | Форма регистрации (email, пароль)                                   | Гости               |
| `/auth/login`           | `LoginPage`              | Форма логина (email, пароль)                                        | Гости               |
| `/`                     | `DashboardPage`          | Список галерей с кнопками “Создать”, “Управлять”                    | Только залогиненные |
| `/galleries/new`        | `NewGalleryPage`         | Кнопка “Создать галерею” → запрос POST `/galleries`                 | Только залогиненные |
| `/galleries/:id`        | `GalleryPage`            | Загрузка фото, кнопка “Генерировать ссылку” → модал создания ссылки | Только залогиненные |
|                         |                          | Таблица ссылок с UUID, expires\_at, счётчиками                      |                     |
| `/s/:shareId`           | `PublicGalleryPage`      | Публичная галерея: grid-layout миниатюр, lightbox при клике         | Публичный доступ    |
| `/s/:shareId/photo/:id` | `PublicPhotoPage` (opt.) | (Опционально) отдельная страница/роут для фото                      | Публичный доступ    |

---

## 4. Основные компоненты и UI-блоки

1. **AuthForm**

   * Поля: Email, Password.
   * Валидация: email формат, мин. длина пароля 8.
   * Ошибки: неверные данные (400/401), спиннер во время запроса.

2. **GalleryList**

   * Карточки галерей: дата создания, кнопки “Открыть” и “Генерировать ссылку”.
   * Пагинация (если >10).

3. **PhotoUploader**

   * Drag-n-drop или кнопка выбора файлов.
   * Прогресс-бар для каждого файла.
   * Валидация размера (≤ 15 МБ) и типа (JPG/PNG).

4. **ShareLinkModal**

   * Поле выбора даты истечения (DatePicker) или “Без срока”.
   * Кнопка “Создать” → POST `/galleries/{id}/share-links`.
   * Показывать сгенерированный UUID и ссылку-копировать.

5. **ShareLinkTable**

   * Колонки: Link (UUID), Expires At, Views, ZIP-downloads, Single-downloads, Actions (Copy, Delete).
   * Форматирование даты, сортировка по дате/счётчикам.

6. **PublicGalleryGrid**

   * CSS Grid: адаптивно меняется кол-во колонок (4➞2➞1).
   * Lazy-loading изображений (Intersection Observer).
   * При клике открывает **Lightbox**.

7. **Lightbox**

   * Полноэкранный режим, стрелки “вперёд/назад”, кнопка скачивания.
   * Плавная анимация переходов.

8. **DownloadButtons**

   * “Скачать всё” (trigger `/download/all`) + “Скачать фото” (trigger `/download/{photo_id}`).

---

## 5. Интеграция с API

* **HTTP-клиент:**

  * Базовая настройка: `baseURL`, таймаут.
  * Интерсепторы запросов: добавлять `Authorization: Bearer <access>`; при 401 запускать рефреш токена `/auth/refresh`.

* **Запросы React Query (или кастомные hooks):**

  * `useGalleries()`: GET `/galleries`
  * `useCreateGallery()`: POST `/galleries`
  * `useUploadPhotos(galleryId)`: POST `/galleries/{id}/photos`
  * `useShareLinks(galleryId)`: GET `/galleries/{id}/share-links`, `useCreateShareLink` для POST
  * `usePublicGallery(shareId)`: GET `/s/{shareId}`
  * `downloadAll(shareId)`: window\.open or Blob+URL.createObjectURL
  * `downloadPhoto(shareId, photoId)`

* **Обработка ошибок и стейтов:**

  * `isLoading`, `isError`, `error` от React Query.
  * Глобальный компонент `<Toast />` для всплывающих уведомлений об успехе/ошибках.

---

## 6. Стилизация и дизайн

* **Tailwind CSS:**

  * Конфигурация: цветовая палитра, утилиты для адаптива.
  * Темная/светлая тема (опционально).

* **Макеты и адаптивность:**

  * Десктоп: экран ≥1024px – 4 колонки в галерее.
  * Планшет: 768–1023px – 2 колонки.
  * Мобила: <768px – 1 колонка, полноэкранный lightbox.

* **UX-детали:**

  * Спиннеры на кнопках/при загрузке.
  * Дисэйбл кнопок во время запроса.
  * Подсказки и тултипы (например, “макс. 15 МБ”).

---

## 7. Тестирование

* **Unit-тесты компонентов:** Jest + React Testing Library

  * Отрисовка форм, валидация, взаимодействия (клики, ввод).
* **Integration-тесты HTTP-hooks:** моки Axios/Fetch.
* **E2E (опционально):** Cypress

  * Сценарии: регистрация → создание галереи → загрузка фото → генерация ссылки → публичный просмотр → скачивание.

---

## 8. CI/CD и сборка

* **Скрипты npm:**

  * `npm run dev` – разработка (Vite).
  * `npm run build` – продакшн-бандл.
  * `npm run lint`, `npm run test`.

* **GitHub Actions (пример):**

  1. Установка, `npm ci`
  2. `npm run lint`
  3. `npm run test`
  4. `npm run build`
  5. Деплой статических файлов на хостинг (Netlify/Vercel).

---

## 9. Roadmap Frontend MVP

| Sprint   | Задачи                                                                                            | Оценка |
| -------- | ------------------------------------------------------------------------------------------------- | ------ |
| Sprint 1 | Настройка проекта (Vite/React), авторизация (register/login), хранение токенов, базовая навигация | 5 дн.  |
| Sprint 2 | Dashboard: список галерей, создание галереи, пагинация                                            | 5 дн.  |
| Sprint 3 | Загрузка фото, прогресс-бар, валидация файлов                                                     | 5 дн.  |
| Sprint 4 | ShareLink UI: создание ссылки, таблица ссылок с метриками                                         | 5 дн.  |
| Sprint 5 | Публичная галерея: grid, lazy-load, lightbox, скачивание                                          | 5 дн.  |
| Buffer   | Тесты, багфикс, CI/CD, документация                                                               | 5 дн.  |

---

**Готовность:** после выполнения спринтов фронтенд обеспечит полную функциональную связку с вашим FastAPI-бэкендом и позволит запустить MVP в прод.
